<%- include('partials/header') %>

<h2>All Books</h2>


<!-- Sorting options -->
<form method="GET" action="/home">
  <label>Sort by:</label>
  <select name="sort" class="sort">
    <option value="title"  <%= sortBy === 'title' ? 'selected' : '' %>>Title</option>
    <option value="rating"  <%= sortBy === 'rating' ? 'selected' : '' %>>Rating</option>
    <option value="date"  <%= sortBy === 'date' ? 'selected' : '' %>>Recency</option>
  </select>
  <button type="submit">Sort</button>
</form>
<a href="/add" class="addb">Add Your Book From Here</a>
<!-- Loop through books and display each one -->
<ul class="book-list">
  <% books.forEach(book => { %>
    <div class="book">
      <!-- Use fallback image if cover_url is not available -->
      <img src="<%= book.cover_url %>" alt="Book Cover">
      <h3><%= book.title %></h3>
      <p>Author: <%= book.author %></p>
      <p>Rating: <%= book.rating %>/5</p>
      <p class="date">Read Date: <%= book.read_date_iso %></p>
      <p class="note">Notes:<%= book.notes %></p> 
      
      <a href="/edit/<%= book.id %>" class="edit">Edit</a>
      <a href="/delete/<%= book.id %>" class="delete">Delete</a>
      
    </div>
   
  <% }) %>

</ul>
<a class="Log" href="/logout" role="button">Log Out</a> 
<script>
  document.querySelectorAll('.date').forEach((element) => {
    const isoDate = element.getAttribute('data-iso');
    const date = new Date(isoDate);
    element.textContent = date.toLocaleString('en-US', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true,
    }); // Uses the browser's local timezone
  });
</script>
<%- include('partials/footer') %>
